# Alignment(C11)
アライメント

Cの低レベルの機能:
ハードウェアアーキテクチャを最大活用するためにメモリ内のオブジェクトの正確なアライメントを指定できる機能。

データがそのデータサイズの倍数であるアドレスに格納されている:
CPUの読み取りと書き込みの機能が向上する。
例:4バイトの整数が4の倍数であるアドレスに格納されているとより効率的にアクセスできる。
データがアラインされたいないとCPUではデータにアクセスするためにより多くのアドレス計算処理を行う。

コンパイラがサイズに基づいてデータがアラインされる。
→charは1バイト境界、shortは2バイト境界、int,long,floatは4バイト境界、doubleは8バイト境界。

頻繁に使用されるデータをプロセッサのキャッシュラインのサイズにアラインする→キャッシュパフォーマンスを改善できる。
例:サイズが32バイト未満の構造体を定義
32バイトのアライメントを使用して、構造体のすべてのインスタンスが効率的にキャッシュされるようにするとよい。
※アライメントについて心配する必要はない。

コンパイラ:
通常、ターゲットプロセッサとデータのサイズに基づいて、自然な境界にデータをアラインする。
データは、32ビットプロセッサでは最大4バイト境界、64ビットプロセッサでは最大で8バイト境界にアラインされる。
データ構造にカスタムアラインメントを指定することで、パフォーマンスの向上やメモリの節約を実現できる。

_Alignof:
型または変数の適切なアラインメントを取得したり、_Alignasを使用して、変数またはユーザー定義型のカスタムアラインメントを指定したりする。

支援マクロalignofと<stdalign.h>alignasは、それぞれ_Alignofと_Alignasに直接マップされる。
→C++で使用されるキーワードと一致する。
2つの言語間でコードを共有うる場合は、コードの移植性を確保するためにCのキーワードではなく、そのマクロを使用すると役立つことがある。


## alignsと＿Alignas
alignas,_Alignas:
変数またはユーザー定義型のカスタムアライメントを指定する。
構造体、共有体、列挙型、変数に適用できる。

alignasの構文:
```lang:C
alignas(type)
alignas(constant-expression)
_Alignas(type)
_Alignas(constant-expression)
```

_Alignas:
register指定子で宣言されたtypedef、ビットフィールド、関数、関数パラメーター、オブジェクトの宣言では使用できない。
１、２、４、８、１６など2の累乗であるアラインメントを指定する。
型のサイズよりも小さい値は使用してはいけない。

